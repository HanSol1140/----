# Nodejs 다운로드

<a href="https://nodejs.org/">nodejs 다운로드 페이지</a>

해당 페이지로 이동하여 nodejs를 다운로드합니다. (설치과정 생략)

명령 프롬프트를 실행하여

>node -v
>
>npm -v

node와 npm이 제대로 설치되었는지 확인할 수 있습니다.

![image](https://github.com/HanSol1140/did/assets/121269266/b721845e-87a9-41cd-91ca-d462d5badd82)


# MTStar 프로그램 다운로드

## 프로그램 설치

<a href="http://www.mtstar.net/adc/document/xf_adclan_package_i18n">프로그램 다운로드 페이지</a>

![image](https://github.com/HanSol1140/did/assets/121269266/d1d69cfd-f98b-46da-92a4-b64b162e20f1)

해당 프로그램을 설치합니다. (설치과정 생략)


<br><br>


## 프로그램 실행

![image](https://github.com/HanSol1140/did/assets/121269266/37f955d8-2ed8-45dc-8c36-6c2f6cd5f03d)

설치된 프로그램을 실행합니다.

![image](https://github.com/HanSol1140/did/assets/121269266/0882865b-b042-439b-92f8-7f9d989087f6)

start server를 누르고 기다립니다.

![image](https://github.com/HanSol1140/did/assets/121269266/5c1d918f-b001-476a-bd00-7d3aa946aea0)

![image](https://github.com/HanSol1140/did/assets/121269266/cd98a681-42e2-4b3a-9272-4d26489a24f8)

username은 admin / password는 123456이라고 알려줍니다.

ok를 눌러주시면 웹브라우저가 실행됩니다.

![image](https://github.com/HanSol1140/did/assets/121269266/7e26fa36-10a4-4b51-ae7e-205973c41671)

프로그램에서 알려준 admin / 123456 / 그리고 우측에 보이는 자동입력 방지번호를 입력하고 로그인해주세요.

![image](https://github.com/HanSol1140/did/assets/121269266/24c364f3-69f8-4040-9cce-8d0b1af0f02d)

해당 페이지가 보입니다.


<br><br>


## DID 설정하기

DID를 실행화면

![image](https://github.com/HanSol1140/did/assets/121269266/8dfe4cff-8042-49d0-b4a3-c0613473410e)

표시된 부분의 setting을 눌러줍니다.

먼저 제일 하단의 NET부분을 눌러서 WIFI를 연결해줍니다.

이후 Setting - Device Status를 누르면

1. 기기명(임의로 설정)
  
2. 서버IP - 서버 컴퓨터의 ipconfig으로 확인
 
3. 포트명 8780

   ![image](https://github.com/HanSol1140/did/assets/121269266/694ec9c5-1c59-4201-a23f-6eb7fd5ec905)
 
4. user code 666

   상단의 로그인 페이지에서 빨간색으로 표시한 user code 입력

해당 값에 맞게 설정해줍니다.

![image](https://github.com/HanSol1140/did/assets/121269266/c172f94a-48cd-4fbe-bcf8-be53b001e6c5)

이제 디바이스가 추가된것을 확인할 수 있습니다.


<br><br>


## 광고 추가하기

### materials 추가하기

![image](https://github.com/HanSol1140/did/assets/121269266/8b6e934b-80a8-428a-805d-29544d0519b9)


좌측 메뉴에서 materials을 누르고 upload버튼을 눌러 재료를 추가합니다.

먼저 video 탭에서 동영상 세개를 추가해줍니다.

![image](https://github.com/HanSol1140/did/assets/121269266/297fc23a-952b-46f5-badc-27ecd39400bd)

img 탭에서도 이미지 세개를 추가해줍니다.

![image](https://github.com/HanSol1140/did/assets/121269266/72b121e6-f8d7-4702-9c30-6670ab1e77f3)

<br><br>

광고로 사용할 materials를 모두 추가했다면 이제 advert탭으로 이동하여 광고를 생성합니다.

![image](https://github.com/HanSol1140/did/assets/121269266/4829192b-7eb1-4180-96f4-8c432a79a4c3)

![image](https://github.com/HanSol1140/did/assets/121269266/65562f40-1d3d-41fb-ba89-5406df0a21f0)

![image](https://github.com/HanSol1140/did/assets/121269266/467deafb-9c71-4973-99b7-79a1f436ddba)


상세한 설정방법은 생략

![image](https://github.com/HanSol1140/did/assets/121269266/ebbaa73f-25d4-431a-a9bd-f184742603c1)

이제 생성한 광고목록이 추가된걸 볼 수 있습니다.


<br><br>

## 서버파일 받기 & 접속 설정 기입

서버 파일을 받기전에 먼저 MTSTAR에 로그인하여 줍니다.

![image](https://github.com/HanSol1140/did/assets/121269266/0fe175df-4be7-4023-a8f3-3db2121f7f71)

![image](https://github.com/HanSol1140/did/assets/121269266/11ef84b2-35e6-4b23-9b79-8db83bc237f2)


system - acount - accecss token

![image](https://github.com/HanSol1140/did/assets/121269266/22bc71cb-34e9-486c-a37a-9b263abf0b48)

밑줄친 두 값을 메모해놓습니다. (브라우저를 실행한채로 둡니다.)

<a href="https://github.com/HanSol1140/did">https://github.com/HanSol1140/did</a>

이제 해당 페이지로 접속해서 .ZIP파일을 다운로드합니다.

![image](https://github.com/HanSol1140/did/assets/121269266/59379491-a6a7-4a1b-b620-4deb7d3378a0)

다운로드받은 ZIP 파일을 원하는 경로에 압축해제 해주세요.

저는 C:\did-master 경로로 압축해제 하였습니다

![image](https://github.com/HanSol1140/did/assets/121269266/ee497d03-61e5-4f06-a24c-48fbe1ea8a24)

설치한 경로로 이동해주세요

![image](https://github.com/HanSol1140/did/assets/121269266/6c39cb7c-807d-4d5d-a16b-39de9baccc71)

server.js 파일을 메모장으로 실행해줍니다.

<br><br>

![image](https://github.com/HanSol1140/did/assets/121269266/23dfadad-522b-43f1-8f53-3e67ebc081aa)
```javascript
mqttIP = "접속할 MQTT Broker IP:PORT";
access_token = "MTSTAR에서 받은 authtoken값"
access_secret  = "MTSTAR에서 받은 secret값""
```

해당 값을 설정했다면 저장을 누르고 메모장을 종료합니다.

<br><br>

이제 명령프롬프트를 실행하여 설치된 경로로 이동, 다음 명령어를 실행합니다.

※MTSTAR가 실행되어 있어야 합니다.


>npm i
>
>node server.js

![image](https://github.com/HanSol1140/did/assets/121269266/d5d390cf-4a8c-4a1c-847f-68eafdbc13e6)

서버가 실행됬다면 웹브라우저를 실행해서 localhost:8083으로 접속해주세요

![image](https://github.com/HanSol1140/did/assets/121269266/9227e367-fc69-4f67-a445-830bea81b056)


MTSTAR에서 추가한 광고목록이 보입니다.


<br><br>

# advertplan 생성

![image](https://github.com/HanSol1140/did/assets/121269266/fa620414-3fa0-40d2-8548-e3ee313e15eb)

<a href="http://localhost:8083/plan">http://localhost:8083/plan</a>로 접속하여 주세요.

![image](https://github.com/HanSol1140/did/assets/121269266/f34893d3-14db-452f-a608-75d4845f3219)

![image](https://github.com/HanSol1140/did/assets/121269266/f26a96e4-05b4-4d85-b2cc-c62390b02eda)

![image](https://github.com/HanSol1140/did/assets/121269266/bb562cdd-3248-451d-9fbc-7e3a1ecb8705)

이런식으로 재생할 광고목록과 디바이스를 선택해주세요.

![image](https://github.com/HanSol1140/did/assets/121269266/2827c012-4d60-4940-9cec-4553cdbc5cec)

나머지 사항을 설정하고 등록 버튼을 누릅니다.

![image](https://github.com/HanSol1140/did/assets/121269266/f3b510c7-2f20-41fb-a1e8-2b1f73e2ca0e)

advertplan이 등록된걸 확인할 수 있습니다.


# 서버에서 MQTT를 통해 DID 재생 변경하기

서버에서 MQTT를 통해 DID를 변경하는 방법을 설명합니다.


javascript로 보내는 MQTT 예시

```javascript
var message = {
  cMarksNames : "nnx10, nnx11",
  planName: "hansol image advert 004, hansol image advert 005, hansol image advert 006",
  marqueName : "test1, test2"
};
client.publish('did_in', JSON.stringify(message));
```

여러개를 한번에 보낼경우 구분자는 , 입니다.

## cMarksNames

해당 값은 DID기기에서 따로 설정이 가능하며

MTSTAR로 접속하여 확인할 수 있습니다.

![image](https://github.com/HanSol1140/did/assets/121269266/acc62691-42b3-472c-80a2-478ac1addd05)

## planName

server.js를 통해 생성한 advertplan명을 기입합니다.

![image](https://github.com/HanSol1140/did/assets/121269266/9282e490-0503-4d9a-b926-4bea331b2994)

## marqueName

![image](https://github.com/HanSol1140/did/assets/121269266/243e8921-da8f-400d-8eb5-40bf086c46fe)


메인 서버에서 원하는 상황에 설정하고싶은 기기명과 planName, marqueName을

JSON포맷으로 MQTT Broker의 did_in 토픽으로 전송해주면 됩니다.
